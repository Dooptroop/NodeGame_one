
<head>
  <link rel="stylesheet" href="/client/css/styles.css">
</head>
<!-- <html>
<head>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<h1>This is a heading</h1>
<p>This is a paragraph.</p>

</body>
</html> -->
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>

</head>
<body>

	<!-- Login Container -->
	<div class="login" style="display:none;width:400px;margin:16pxauto;font-size: 16px;">
	  <div class="login-triangle" style="width: 0;margin-right: auto;margin-left: auto;border: 12px solid transparent;border-bottom-color: #28d;"></div>
	  
	  <h2 class="login-header" style="margin-top: 0;margin-bottom: 0;background: #28d;padding: 20px;font-size: 1.4em;font-weight: normal;text-align: center;text-transform: uppercase;color: #fff;">Log in</h2>

	  <form class="login-container" style="background: #ebebeb;padding: 12px;">
	    <p style="padding: 12px;margin-top: 0;margin-bottom: 0;">
	    <input 
	    style="border-color: #888;box-sizing: border-box;display: block;width: 100%;border-width: 1px;border-style: solid;padding: 16px;outline: 0;font-family: inherit;font-size: 0.95em;" type="email" placeholder="Email"></p>
	    <p style="padding: 12px;margin-top: 0;margin-bottom: 0;">
	    <input style="border-color: #888;box-sizing: border-box;display: block;width: 100%;border-width: 1px;border-style: solid;padding: 16px;outline: 0;font-family: inherit;font-size: 0.95em;" type="password" placeholder="Password"></p>
	    <p style="padding: 12px;margin-top: 0;margin-bottom: 0;">
	    <input 
	     type="submit" value="Login" style="background: #28d;border-color: transparent;color: #fff;cursor: pointer;"></p>
	  </form>
	</div>

  <div id="console-text" style="width:500px; height:150px; border: 1px solid #000000; overflow-y: scroll; color: lawngreen; background-color: black;">
    <div style="text-align: center;"></div>
  </div>

	<!-- Game Canvas  -->
	<canvas id="ctx" class="canvas" width="500" height="500" style="border:1px solid black;"></canvas>

  <!--Message Container-->
  <div id="chat-text" style="width:500px; height:150px; border: 1px solid #000000; overflow-y: scroll;">
    <!--<div style="text-align: center;">::Message Board!::</div>-->
  </div>
  <form id="chat-form" style="padding: 5px 0 0 0;">
    <input type="text" id="chat-input" style="width: 500px;" value="" name="message_area">
  </form>


  <!--SCRIPTS-->
  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script type="text/javascript">

    var chatText = document.getElementById('chat-text');
    var consoleText = document.getElementById('console-text');
    var chatInput = document.getElementById('chat-input');
    var ctx = document.getElementById("ctx").getContext("2d");
    ctx.font = '30px Arial';

    // initalize connection
    var socket = io();

    //Output
    var login = function(user, password){
      socket.emit('login',{
        reason: 'logged out'
      });
    };
    //Login
    $( ".login-container" ).submit(function( event ) {

      var user = "test";
      var password = "testpass";
      //TODO VALIDATION
      login(user, password);

      event.preventDefault();
    });

    //Add To Chat socket listener
    socket.on('addToChat', function(data){chatText.innerHTML += '<div>' + data + '</div>'});
    //Listen for the return of the command evaluation
    socket.on('evalAnswer', function(data){
      consoleText.innerHTML += '<div class="command-eval">' + data + '</div>';
      console.log(data);
    });

    //Add To Chat Submit Function
    $('#chat-form').submit(function(e) {
      e.preventDefault();
      console.log(chatInput.value[0]);
      if(chatInput.value === '/clear'){
        consoleText.innerHTML = '';
      } else if (chatInput.value[0] === '/') {
        //message is command
        console.log('evalServer');
        socket.emit('evalServer', chatInput.value.slice(1));
      }
      else {
        //message is message
        socket.emit('sendMsgToServer', chatInput.value);
      }
      chatInput.value = '';
    });

		/*
     * New Position
     * Update the player location
     */
  	socket.on('newPositions', function(data){
		ctx.clearRect(0,0,500,500);
		for(var i = 0; i < data.player.length; i++)
			ctx.fillText(data.player[i].number,data.player[i].x,data.player[i].y);

    for(var i = 0; i < data.bullet.length; i++)
      ctx.fillRect(data.bullet[i].x - 5, data.bullet[i].y - 5, 10, 10);
  	});

  	/*
  	*  Key Down Event Handler
  	*/
  	var d = 68;
  	var a = 65;
  	var w = 87;
  	var s = 83;

  	document.onkeydown = function(event){
  		if(event.keyCode === d)
  			socket.emit('keyPress', {inputId:'right', state:true});
  		else if(event.keyCode === s)
  			socket.emit('keyPress', {inputId:'down', state:true});
  		else if(event.keyCode === a)
  			socket.emit('keyPress', {inputId:'left', state:true});
  		else if(event.keyCode === w)
  			socket.emit('keyPress', {inputId:'up', state:true});
  	};

	  /*
  	*  Key Up Event Handler
  	*/
  	document.onkeyup = function(event){
  		if(event.keyCode === d)
  			socket.emit('keyPress', {inputId:'right', state:false});
  		else if(event.keyCode === s)
  			socket.emit('keyPress', {inputId:'down', state:false});
  		else if(event.keyCode === a)
  			socket.emit('keyPress', {inputId:'left', state:false});
  		else if(event.keyCode === w)
  			socket.emit('keyPress', {inputId:'up', state:false});
  	};

    /*
     *  Mouse Down Event Handler
     */
//    $(document).mousemove(function (event) {
//      console.log('jquery down');
//      socket.emit('keypress', {inputId:'attack',state:true})
//    });
  	document.onmousedown = function (event) {
  	  console.log('doc.m down');
      socket.emit('keyPress', {inputId:'attack',state:true})
    };

    /*
     *  Mouse up Event Handler
     */
    document.onmouseup = function (event) {
      socket.emit('keyPress', {inputId:'attack',state:false})
    };

    /**
     * Mouse Angle Function
     */
    document.onmousemove = function (event) {
      var x = -250 + event.clientX - 8;
      var y = -250 + event.clientY - 8;
      var angle = Math.atan2(y,x) / Math.PI * 100;
      socket.emit('keyPress', {inputId:'mouseAngle', state:angle})
    }
  </script>
</body>
</html>






